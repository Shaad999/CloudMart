<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloud Mart - User</title>
<style>
body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:0; }
header { background:#fff; padding:15px; text-align:center; font-size:22px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.container { padding:20px; }
.products { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; }
.card { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center; transition:.3s; }
.card:hover { transform:translateY(-5px); }
.card img { width:100%; height:150px; object-fit:cover; border-radius:8px; }
.card button { margin-top:10px; padding:10px 15px; border:none; border-radius:8px; background:#333; color:#fff; cursor:pointer; }
.card button:hover { background:#555; }

/* Order Modal */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
.modal-content { background:#fff; margin:5% auto; padding:20px; border-radius:10px; width:90%; max-width:400px; position:relative; }
.close { position:absolute; right:15px; top:10px; cursor:pointer; font-size:22px; }

.modal-content input, .modal-content select, .modal-content button { 
  width:100%; margin:8px 0; padding:10px; border:1px solid #ccc; border-radius:8px; 
}

#bkashFields, #nagadFields { background:#f9f9f9; padding:10px; border-radius:8px; margin-top:10px; }
</style>
</head>
<body>
<header>Cloud Mart - User Panel</header>
<div class="container">
  <h2>Available Products</h2>
  <div class="products" id="productsList"></div>
</div>

<!-- Order Modal -->
<div class="modal" id="orderModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3>Order Product</h3>
    <form id="orderForm">
      <input type="text" id="orderProduct" readonly><br>
      <input id="orderDescription" readonly><br>
      <input type="text" id="userName" placeholder="Your Name" required><br>
      <input type="email" id="userEmail" placeholder="Email" required><br>
      <input type="tel" id="userPhone" placeholder="Phone Number" required><br>
      
      <!-- Payment Method -->
      <select id="paymentMethod" required>
        <option value="">Select Payment</option>
        <option value="Bkash">Bkash</option>
        <option value="Nagad">Nagad</option>
      </select><br>

      <!-- Bkash Fields -->
      <div id="bkashFields" style="display:none;">
        <p><b>Bkash Number:</b> <span id="adminBkashNum"></span></p>
        <input type="text" id="sendNumberBkash" placeholder="Your Send Money Number"><br>
        <input type="text" id="trnxIDBkash" placeholder="Transaction ID"><br>
      </div>

      <!-- Nagad Fields -->
      <div id="nagadFields" style="display:none;">
        <p><b>Nagad Number:</b> <span id="adminNagadNum"></span></p>
        <input type="text" id="sendNumberNagad" placeholder="Your Send Money Number"><br>
        <input type="text" id="trnxIDNagad" placeholder="Transaction ID"><br>
      </div>

      <button type="submit">Submit Order</button>
      <button type="button" onclick="closeModal()">Cancel</button>
    </form>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* Firebase Config */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* Load Products */
const productsList=document.getElementById("productsList");
onValue(ref(db,"products"),snapshot=>{
  productsList.innerHTML="";
  snapshot.forEach(item=>{
    const data=item.val();
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <img src="${data.image}" alt="${data.name}">
      <h3>${data.name}</h3>
      <p>${data.description}</p>
      <p><b>Price:</b> ${data.price}৳</p>
      <button onclick="openModal('${data.name}','${data.description}')">Order Now</button>
    `;
    productsList.appendChild(div);
  });
});

/* Load Payment Numbers */
onValue(ref(db,"payment"),snapshot=>{
  const data=snapshot.val()||{};
  document.getElementById("adminBkashNum").textContent=data.bkash||"Not Set";
  document.getElementById("adminNagadNum").textContent=data.nagad||"Not Set";
});

/* Open Modal */
window.openModal=(name,desc)=>{
  document.getElementById("orderProduct").value=name;
  document.getElementById("orderDescription").value=desc;
  document.getElementById("orderModal").style.display="block";
};
window.closeModal=()=>{ document.getElementById("orderModal").style.display="none"; };

/* Payment Toggle */
document.getElementById("paymentMethod").addEventListener("change",()=>{
  const method=document.getElementById("paymentMethod").value;
  document.getElementById("bkashFields").style.display= method==="Bkash" ? "block":"none";
  document.getElementById("nagadFields").style.display= method==="Nagad" ? "block":"none";
});

/* Order Submit */
document.getElementById("orderForm").addEventListener("submit",e=>{
  e.preventDefault();
  const method=document.getElementById("paymentMethod").value;
  const newOrder={
    product:document.getElementById("orderProduct").value,
    description:document.getElementById("orderDescription").value,
    name:document.getElementById("userName").value,
    email:document.getElementById("userEmail").value,
    phone:document.getElementById("userPhone").value,
    payment:method,
    sendNumber: method==="Bkash"
      ? document.getElementById("sendNumberBkash").value
      : document.getElementById("sendNumberNagad").value,
    trnx: method==="Bkash"
      ? document.getElementById("trnxIDBkash").value
      : document.getElementById("trnxIDNagad").value,
    date:new Date().toLocaleString()
  };

  const orderRef=push(ref(db,"orders"));
  set(orderRef,newOrder).then(()=>{
    alert("✅ Order Submitted!");
    e.target.reset();
    closeModal();
  });
});
</script>
</body>
</html>
