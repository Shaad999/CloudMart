<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloud Mart - User</title>
<style>
body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:0; }
header { background:#fff; padding:15px; text-align:center; font-size:22px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.container { padding:20px; }
.search-bar { margin-bottom:20px; }
input, select, button { padding:10px; margin:5px 0; border:1px solid #ccc; border-radius:5px; }
.product-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:20px; }
.card { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; opacity:0; transform:translateY(20px); transition:0.5s; }
.card.show { opacity:1; transform:translateY(0); }
.card img { width:100%; height:140px; object-fit:cover; border-radius:8px; transition:0.3s; }
.card:hover img { transform:scale(1.05); }
.card button { background:#007bff; color:#fff; border:none; padding:10px; width:100%; border-radius:5px; cursor:pointer; transition:0.3s; }
.card button:hover { background:#0056b3; }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; opacity:0; transition:0.3s; }
.modal.show { display:flex; opacity:1; }
.modal-content { background:#fff; padding:20px; border-radius:10px; width:320px; animation:fadeIn 0.5s; }
@keyframes fadeIn { from{opacity:0; transform:translateY(-20px);} to{opacity:1; transform:translateY(0);} }
.close { float:right; cursor:pointer; font-weight:bold; }
#bkashFields,#nagadFields { display:none; }
</style>
</head>
<body>
<header>Cloud Mart - User Panel</header>
<div class="container">
  <div class="search-bar">
    <input type="text" id="search" placeholder="Search product...">
    <select id="categoryFilter"></select>
  </div>
  <div class="product-grid" id="productGrid"></div>
</div>

<div class="modal" id="orderModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3>Order Product</h3>
    <form id="orderForm">
      <input type="text" id="orderProduct" readonly><br>
      <input type="text" id="userName" placeholder="Your Name" required><br>
      <input type="email" id="userEmail" placeholder="Email" required><br>
      <input type="tel" id="userPhone" placeholder="Phone Number" required><br>
      <select id="paymentMethod" required>
        <option value="">Select Payment</option>
        <option value="Bkash">Bkash</option>
        <option value="Nagad">Nagad</option>
      </select><br>
      <div id="bkashFields">
        <p>Bkash Number: <span id="adminBkashNum"></span></p>
        <input type="text" id="sendNumberBkash" placeholder="Your Send Money Number"><br>
        <input type="text" id="trnxIDBkash" placeholder="Transaction ID"><br>
      </div>
      <div id="nagadFields">
        <p>Nagad Number: <span id="adminNagadNum"></span></p>
        <input type="text" id="sendNumberNagad" placeholder="Your Send Money Number"><br>
        <input type="text" id="trnxIDNagad" placeholder="Transaction ID"><br>
      </div>
      <button type="submit">Submit Order</button>
    </form>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCjxG7JzLbElQ03bBMeVb-cOlvTBq6pn7o",
  authDomain: "cloudmart-40404.firebaseapp.com",
  databaseURL: "https://cloudmart-40404-default-rtdb.firebaseio.com",
  projectId: "cloudmart-40404",
  storageBucket: "cloudmart-40404.appspot.com",
  messagingSenderId: "1018112523638",
  appId: "1:1018112523638:web:ec5dd627a16aec707dce57",
  measurementId: "G-JD5F9TMYK6"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// DOM
const productGrid = document.getElementById("productGrid");
const search = document.getElementById("search");
const categoryFilter = document.getElementById("categoryFilter");
const orderModal = document.getElementById("orderModal");
const orderProduct = document.getElementById("orderProduct");
const paymentMethod = document.getElementById("paymentMethod");
const bkashFields = document.getElementById("bkashFields");
const nagadFields = document.getElementById("nagadFields");
const adminBkashNum = document.getElementById("adminBkashNum");
const adminNagadNum = document.getElementById("adminNagadNum");

// Load Payment Numbers
db.ref("settings").on("value",snap=>{
  const s = snap.val()||{};
  adminBkashNum.textContent = s.bkashNumber||"";
  adminNagadNum.textContent = s.nagadNumber||"";
});

// Products
let products = [];
db.ref("products").on("value",snap=>{
  products = [];
  snap.forEach(child => { products.push(child.val()); });
  renderCategories();
  renderProducts();
});

// Render Categories
function renderCategories(){
  let cats = [...new Set(products.map(p=>p.category))];
  categoryFilter.innerHTML=`<option value="">All Categories</option>`;
  cats.forEach(c=>{ categoryFilter.innerHTML+=`<option value="${c}">${c}</option>`; });
}

// Render Products
function renderProducts(){
  let term=search.value.toLowerCase();
  let cat=categoryFilter.value;
  productGrid.innerHTML="";
  products.filter(p=>(!cat||p.category===cat)&&p.name.toLowerCase().includes(term))
  .forEach((p,i)=>{
    let card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<img src="${p.image||'https://via.placeholder.com/200'}">
      <h4>${p.name}</h4>
      <p>${p.category}</p>
      <p>${p.description}</p>
      <p><b>$${p.price}</b></p>
      <button onclick="openModal('${p.name}')">Order</button>`;
    productGrid.appendChild(card);
    setTimeout(()=>card.classList.add("show"),100*i);
  });
}

// Modal
function openModal(name){
  orderProduct.value=name;
  orderModal.classList.add("show");
  bkashFields.style.display="none";
  nagadFields.style.display="none";
  paymentMethod.value="";
}
function closeModal(){ orderModal.classList.remove("show"); }

paymentMethod.addEventListener("change",()=>{
  if(paymentMethod.value==="Bkash"){ bkashFields.style.display="block"; nagadFields.style.display="none"; }
  else if(paymentMethod.value==="Nagad"){ nagadFields.style.display="block"; bkashFields.style.display="none"; }
  else { bkashFields.style.display="none"; nagadFields.style.display="none"; }
});

// Submit Order
document.getElementById("orderForm").addEventListener("submit",e=>{
  e.preventDefault();
  const newOrder = {
    product: orderProduct.value,
    name: document.getElementById("userName").value,
    email: document.getElementById("userEmail").value,
    phone: document.getElementById("userPhone").value,
    payment: paymentMethod.value,
    sendNumber: paymentMethod.value==="Bkash"?document.getElementById("sendNumberBkash").value:
                document.getElementById("sendNumberNagad").value,
    trnx: paymentMethod.value==="Bkash"?document.getElementById("trnxIDBkash").value:
          document.getElementById("trnxIDNagad").value,
    date: new Date().toLocaleString()
  };
  db.ref("orders").push(newOrder);
  alert("Order Submitted!");
  printInvoice(newOrder);
  e.target.reset();
  closeModal();
});

// Print Invoice
function printInvoice(o){
  let w=window.open('','_blank');
  w.document.write(`<h2>Cloud Mart Invoice</h2>
    <p>Date: ${o.date}</p>
    <p>Name: ${o.name}</p>
    <p>Email: ${o.email}</p>
    <p>Phone: ${o.phone}</p>
    <p>Product: ${o.product}</p>
    <p>Payment: ${o.payment}</p>
    <p>Send Number: ${o.sendNumber}</p>
    <p>Transaction ID: ${o.trnx}</p>
    <hr><p>Thank you for your purchase!</p>`);
  w.print();
}

search.addEventListener("input",renderProducts);
categoryFilter.addEventListener("change",renderProducts);

</script>
</body>
</html>
